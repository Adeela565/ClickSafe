{% extends "base.html" %}
{% block content %}

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ title or "Results" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f6f7fb;color:#1f2937}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:var(--card); border:1px solid var(--line); border-radius: var(--radius); box-shadow: 0 6px 18px rgba(0,0,0,.06);}
    h1{margin:10px 0}
    .bar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:12px 0 18px}
    select,button{padding:8px 10px;border:1px solid #d1d5db;border-radius:6px;background:#fff}
    a.btn{display:inline-block;padding:8px 12px;border-radius:6px;background:#2563eb;color:#fff;text-decoration:none}
    .statbox{display:flex;gap:12px;margin:12px 0}
    .stat{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:10px 14px;min-width:160px}
    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e5e7eb}
    th,td{padding:10px 12px;border-bottom:1px solid #eef2f7;font-size:14px}
    th{background:#f8fafc;text-align:left}
    .ts{white-space:nowrap}
    
    .back-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.9rem;
    margin-bottom: 14px;
    color: #2563eb;
    text-decoration: none;
    }
    
    .tip-text {
    font-size: 0.85rem;
    color: #6b7280;
    margin-bottom: 16px;
    }
    
  </style>
</head>

<body>
<div class="wrapper">

  <div class="card">
  
    <h1 class="brand" style="font-size:1.8rem;">
    Recipient History
  </h1>
  <p class="subtitle">
    {{ recipient.name }} – {{ recipient.email }}
  </p>

    <div class="bar" style="margin-bottom:1rem;">
      <a href="{{ url_for('main.results') }}"
         style="font-size:0.9rem;color:#2563eb;text-decoration:none;display:inline-flex;align-items:center;gap:4px;">
        ← Back to Results
      </a>
    </div>

    <div class="statbox" style="margin-bottom:1.5rem;">
      <div class="stat"><strong>Total Delivered</strong><div>{{ total_delivered }}</div></div>
      <div class="stat"><strong>Total Clicks</strong><div>{{ total_clicked }}</div></div>
      <div class="stat"><strong>Total Reported</strong><div>{{ total_reported }}</div></div>   
    </div>
    
     <form class="bar" method="get">
      <label for="event_type"><strong>Filter by Event Type:</strong></label>
      <select id="event_type" name="event_type" onchange="this.form.submit()">
        <option value="">All events</option>
        {% for t in event_types %}
          <option value="{{ t }}" {% if t == event_type %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>
      </form>

    <table class="table">
      <thead>
        <tr>
          <th>Campaign</th>
          <th>Event</th>
          <th>IP</th>
          <th class="ts">Timestamp</th>
        </tr>
      </thead>
      <tbody>
        {% if events %}
          {% for e, campaign_name in events %}
          <tr>
            <td>{{ campaign_name }}</td>
            <td>{{ e.event_type }}</td>
            <td>{{ e.ip or "—" }}</td>
            <td class="ts">{{ e.ts }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" style="text-align:center;color:#6b7280;padding:18px;">
              No events recorded for this recipient yet.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>

  </div>
</div>
</body>
</html>

{% endblock %}

